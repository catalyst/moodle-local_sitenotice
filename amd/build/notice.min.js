/**
 * User interaction with notice
 * @author     Nathan Nguyen <nathannguyen@catalyst-au.net>
 * @copyright  Catalyst IT
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_sitenotice/notice",["jquery","core/ajax","core/modal_factory","local_sitenotice/modal_notice"],(function($,ajax,ModalFactory,ModalNotice){var modal,notices={},viewednotices=[],SiteNotice={},nextNotice=function(){var nextnotice=function(){for(var i in notices)if(!viewednotices.includes(i))return viewednotices.push(i),notices[i];return!1}();0!=nextnotice&&(void 0===modal?ModalFactory.create({type:ModalNotice.TYPE,title:nextnotice.title,body:nextnotice.content,large:!0}).then((function(newmodal){(modal=newmodal).setNoticeId(nextnotice.id),modal.setRequiredAcknowledgement(nextnotice.reqack),modal.getModal().on("click",modal.getCloseButtonID(),(function(){dismissNotice(),modal.hide()})),modal.getModal().on("click",modal.getAcceptButtonID(),(function(){acknowledgeNotice(),modal.hide()})),modal.getModal().on("click","a",(function(){var linkid=$(this).attr("data-linkid");trackLink(linkid)})),modal.getModal().on("click",modal.getAckCheckboxID(),(function(){var ischecked=$(modal.getAckCheckboxID()).is(":checked");$(modal.getAcceptButtonID()).attr("disabled",!ischecked),ischecked?modal.turnoffToolTip():modal.turnonToolTip()})),modal.show(),modal.getModal().focus()})):(modal.setTitle(nextnotice.title),modal.setBody(nextnotice.content),modal.setNoticeId(nextnotice.id),modal.setRequiredAcknowledgement(nextnotice.reqack),modal.show(),modal.getModal().focus()))},dismissNotice=function(){var noticeid=modal.getNoticeId();ajax.call([{methodname:"local_sitenotice_dismiss",args:{noticeid:noticeid}}])[0].done((function(response){response.redirecturl?window.open(response.redirecturl,"_parent",""):nextNotice()})).fail((function(ex){this.console.log(ex)}))},acknowledgeNotice=function(){var noticeid=modal.getNoticeId();ajax.call([{methodname:"local_sitenotice_acknowledge",args:{noticeid:noticeid}}])[0].done((function(response){response.redirecturl?window.open(response.redirecturl,"_parent",""):nextNotice()})).fail((function(ex){this.console.log(ex)}))},trackLink=function(linkid){ajax.call([{methodname:"local_sitenotice_tracklink",args:{linkid:linkid}}])[0].done((function(response){response.redirecturl&&window.open(response.redirecturl,"_parent","")})).fail((function(ex){this.console.log(ex)}))};return SiteNotice.init=function(){ajax.call([{methodname:"local_sitenotice_getnotices",args:{}}])[0].done((function(response){notices=JSON.parse(response.notices),$(document).ready((function(){nextNotice()}))})).fail((function(ex){this.console.log(ex)}))},SiteNotice}));

//# sourceMappingURL=notice.min.js.map